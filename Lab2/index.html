<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>Lab 2</title>

	<style>
        .image-container {
            display: inline-block;
            width: 30%;
            margin-right: 1.5%;
            vertical-align: top;
        }

        .image-container img {
            width: 50%;
            height: auto;
        }
    	</style>
	
	</head>

	<body>

		<h1>Laborat√≥rio 2 - Calibra√ß√£o de Cameras</h1>

			<p>Lucas Daniel dos Santos RA: 11063416</p>
			<p>Paulo Henrique Eiji Hayashida RA: 11104714</p>
			<p>Victor Giovanetti Monteiro RA: 11201722116</p>

			<p>Data de realiza√ß√£o do experimento: 02/07/24</p>
			<p>Data de Publica√ß√£o: 16/07/24</p>

			<h2>Introdu√ß√£o</h2>

				<p>Neste laborat√≥rio conseguimos ver alguns dos efeitos que c√¢meras est√£o sujeitas, principalmente por possu√≠rem elementos como lentes e orienta√ß√£o espacial. Sendo assim a calibra√ß√£o √© um passo importante para retirar distor√ß√µes na imagens exibidas. Atrav√©s de c√≥digos em Python e a biblioteca Opencv possibilitam que esse ajuste.</p>
		
			<h2>Parte 1</h2>

				<p>Para a primeira etapa foram disponibilizados 3 links referentes a documenta√ß√µes contendo excplica√ß√µes te√≥ricas sobre tratamento de imagem.</p>
		
				<p>Link 1: https://learnopencv.com/geometry-of-image-formation/</p>

				<p>Para transformar objetos capturados por uma c√¢mera em imagens 2D, √© necess√°rio converter as coordenadas desses objetos para as coordenadas dos pixels correspondentes na imagem. Para isso, utilizam-se tr√™s sistemas de coordenadas. O primeiro sistema de coordenadas √© o sistema de coordenadas do mundo, que indica a posi√ß√£o dos objetos e da c√¢mera no espa√ßo tridimensional. O segundo sistema √© o sistema de coordenadas da c√¢mera, que referencia a transla√ß√£o e rota√ß√£o do objeto em rela√ß√£o √† c√¢mera. O terceiro sistema faz a proje√ß√£o do objeto e leva em considera√ß√£o as propriedades das lentes, corrigindo as distor√ß√µes naturais.</p>
				<p>Assim, supondo que a c√¢mera esteja em uma posi√ß√£o arbitr√°ria, representada por um vetor de transla√ß√£o 3x1,t, e uma orienta√ß√£o arbitr√°ria, representada por uma matriz de rota√ß√£o 3x3, R. Ao combinar essas matrizes em uma √∫nica matriz 3x4, chamada de matriz extr√≠nseca [R‚à£t], podemos transformar as coordenadas dos objetos do espa√ßo 3D para o sistema de coordenadas da c√¢mera</p>
				<p>Para uma c√¢mera pinhole, a imagem projetada √© invertida em 180¬∫ no plano da imagem. No entanto, por conveni√™ncia, assumimos que a imagem est√° projetada na frente do centro √≥ptico. Utilizando geometria b√°sica, a proje√ß√£o da imagem √© dada por x = f*Xc/Zc e y = f*Yc/Zc, onde f √© o ponto focal da c√¢mera, Xc, Yc e Zc s√£o as coordenadas no espa√ßo da c√¢mera, e x e y as coordenadas projetadas. Reescrevendo isso em forma matricial, obtemos a matriz intr√≠nseca, que inclui os par√¢metros intr√≠nsecos da c√¢mera.</p>

				<p>Link 2: https://learnopencv.com/camera-calibration-using-opencv/</p>

				<p>A calibra√ß√£o da c√¢mera √© o processo de estimar os par√¢metros de uma c√¢mera. Isso envolve obter todas as informa√ß√µes necess√°rias (par√¢metros ou coeficientes) sobre a c√¢mera para determinar a rela√ß√£o precisa entre um ponto 3D no mundo real e sua proje√ß√£o 2D na imagem capturada por essa c√¢mera. Geralmente, isso significa recuperar dois tipos de par√¢metros: os par√¢metros internos do sistema c√¢mera/lente, como a dist√¢ncia focal, o centro √≥ptico e os coeficientes de distor√ß√£o radial da lente; e os par√¢metros externos, que se referem √† orienta√ß√£o (rota√ß√£o e transla√ß√£o) da c√¢mera em rela√ß√£o a algum sistema de coordenadas do mundo.</p>
				<p>O objetivo do processo de calibra√ß√£o √© encontrar os valores dos par√¢metros intr√≠nsecos e extr√≠nsecos. Sendo elas matriz intr√≠nsica 3√ó3 ùêæ, a matriz de rota√ß√£o 3√ó3 R e o vetor de transla√ß√£o 3√ó1 t. Usando um conjunto de pontos 3D conhecidos  e suas coordenadas de imagem correspondentes. A calibra√ß√£o pode ser feita de diferentes formas, tais como padr√£o de calibra√ß√£o, quando se tem algum padr√£o como xadrez ou padr√µes circulares com tamanhos conhecidos; pistas geom√©tricas, por meio de linhas retas e pontos de fuga; e baseada em Deep Learning.</p>
				<p>O processo de calibra√ß√£o da c√¢mera come√ßa com a defini√ß√£o das coordenadas do mundo real usando um padr√£o de tabuleiro de xadrez com dimens√µes conhecidas. Esse padr√£o √© fotografado de diferentes orienta√ß√µes para capturar os cantos dos quadrados, que s√£o usados para definir um sistema de coordenadas do mundo onde todos os pontos est√£o no plano XY com Z = 0. O padr√£o de tabuleiro de xadrez √© amplamente utilizado devido √† sua facilidade de detec√ß√£o e √† clareza dos gradientes nos cantos dos quadrados. Em seguida, √© necess√°rio localizar os cantos dos quadrados usando a fun√ß√£o cv2.findChessboardCorners(). Para melhorar a precis√£o, pode-se utilizar a fun√ß√£o cv2.cornerSubPix(). Por fim, a fun√ß√£o cv2.calibrateCamera() utiliza os par√¢metros obtidos nos passos anteriores para calibrar a c√¢mera.

</p>

				<p>Link 3: https://docs.opencv.org/4.x/dc/dbb/tutorial_py_calibration.html</p>

				<p>O terceiro link apresenta um problema que pode ocorrer quando o equipamento n√£o est√° parametrizado, dessa forma a distor√ß√£o radial apresenta deforma√ß√µes na imagem, dando a impress√£o de que as linhas retas na verdade s√£o curvas.</p>
				<p>Tamb√©m √© apresentado um m√©todo de parametriza√ß√£o que faz uso de algumas imagens de amostra, com um padr√£o de figura bem definido e pontos com dist√¢ncias entre si que s√£o conhecidas, assim conhecemos as coordenadas desses pontos no mundo real podemos encontrar os parametros da c√¢mera.</p>

			<h2>Parte 2</h2>

				<p>Nessa etapa faremos a calica√ß√£o da c√¢mera baseado no "Link 2" e utilizando o arquivo L2_cal.py</p>
				<p>Esses parametros s√£o divididos em duas partes, internos e externos.</p>
				<p>Os parametros intrinsicos est√£o diretamente relacionados ao equipamento de captura, como a dist√¢ncia focal ou o centro √≥ptico da c√¢mera.</p>
				<p>Os parametros extrinsicos ou externos s√£o definidos levando em considera√ß√£o o sistema de coordenadas do mundo real que foi adotado e utilizando as matrizes de rota√ß√£o e transla√ß√£o. </p>

				<p>Utilizando as fun√ß√µes do opencv √© poss√≠vel que o c√≥digo identifique o padr√£o observado no tabuleiro de xadrez e com a fun√ß√£o cv.calibrateCamera() recebemos os valores dos parametros da c√¢mera.</p>

				<h3>a) </h3>

				<p>Para resolu√ß√£o do item acima foi necess√°rio apontar a variavel img para os arquivos de amostras.</p>

				<p>Camera matrix : </p>

					<p>[[536.07343567   0.         342.37038373]<br>
					 [  0.         536.01635124 235.53685496]<br>
					 [  0.           0.           1.        ]]</p>
					
					
					 <p>dist : </p>
					
					<p>[[-0.26509012 -0.04674346  0.00183301 -0.00031472  0.25231495]]</p>
					
					<p>(array([[-0.3746336 ],
						   [ 0.06982835],
						   [-0.01937108]]),<br>
						array([[ 0.05280146],
						   [-0.60171821],
						   [-0.18453822]]),<br>
						array([[-0.34698248],
						   [-0.06738503],
						   [-1.20088995]]),<br>
						array([[ 0.1972109 ],
						   [-0.42009945],
						   [-0.1949708 ]]),<br>
						array([[ 0.4828725 ],
						   [-0.17036999],
						   [-1.40740334]]),<br>
						array([[-0.10141611],
						   [ 0.32034835],
						   [ 0.3147293 ]]),<br>
						array([[-0.08398745],
						   [ 0.34802803],
						   [-1.54244125]]),<br>
						array([[-0.22584694],
						   [ 1.0155114 ],
						   [-2.79470629]]),<br>
						array([[-0.47359527],
						   [ 0.08970849],
						   [-0.22605977]]),<br>
						array([[-0.35339069],
						   [ 0.24071879],
						   [ 0.20970029]]),<br>
						array([[ 0.49542331],
						   [ 0.11948824],
						   [-0.29675962]]),<br>
						array([[0.06525918],
						   [0.44701849],
						   [0.10800011]]),<br>
						array([[-0.27527337],
						   [ 0.10123358],
						   [-1.56296566]]))</p>
					<p>tvecs : 
					
					<p>(array([[-2.95848507],
						   [-3.94417917],
						   [13.21423801]]),<br>
					array([[-2.16838614],
						   [-3.50011104],
						   [10.73694876]]),<br>
					array([[-3.42743405],
						   [ 0.48738235],
						   [11.56153534]]),<br>
					array([[-2.67642764],
						   [-3.18945558],
						   [10.58262296]]),<br>
					array([[-3.50264504],
						   [ 1.6159546 ],
						   [11.97222434]]),<br>
					array([[-3.72585127],
						   [-4.31084787],
						   [17.2043959 ]]),<br>
					array([[-2.96218139],
						   [ 0.57159003],
						   [16.83013784]]),<br>
					array([[ 2.53399669],
						   [ 4.3199921 ],
						   [13.71918905]]),<br>
					array([[-2.5179161 ],
						   [-3.4306905 ],
						   [12.85702176]]),<br>
					array([[-1.59003858],
						   [-4.31771177],
						   [14.01040699]]),<br>
					array([[-3.40557301],
						   [-2.4104226 ],
						   [12.58706846]]),<br>
					array([[ 2.207421  ],
						   [-3.21446546],
						   [15.60125332]]),<br>
					array([[-3.99387882],
						   [ 2.27704401],
						   [12.68878148]]))</p>
		

		
				<h3>b) </h3>

				<p>Caminho dos arquivos da parte 2: ./grupo-samples/</p>
				<p></p>Arquivo alterado para execu√ß√£o do item B, utilizando a nossa imagem do tabuleiro.</p>

				<p>Camera matrix : </p>

				<p>[[691.29939128   0.         326.80276268]<br>
					[  0.         692.13240307 219.64457563]<br>
					[  0.           0.           1.        ]]</p>
				<p>	dist : </p>

					<p>[[ 1.21164755e-01 -1.80341820e+00  1.64363312e-04 -7.60266984e-03
					9.12197319e+00]]</p>
					<p>rvecs : </p>

					<p>(array([[ 0.34030661],
						[-0.64395203],
						[ 1.45726228]]), <br>array([[ 0.66439822],
						[-0.82912519],
						[-1.08610413]]), <br>array([[ 0.64222347],
						[-0.6413235 ],
						[ 1.46444406]]), <br>array([[-0.1302544 ],
						[ 0.10646706],
						[-1.0387285 ]]), <br>array([[-0.82851336],
						[ 0.6535799 ],
						[ 1.36696742]]), <br>array([[-0.90199068],
						[ 0.24249242],
						[ 1.32461194]]), <br>array([[-0.51136924],
						[-0.06175017],
						[-0.23997589]]), <br>array([[-0.11743436],
						[ 0.21082132],
						[ 1.50923599]]), <br>array([[-0.73333152],
						[-0.41849031],
						[-0.63287277]]), <br>array([[-0.15481039],
						[-0.59235345],
						[ 1.29567114]]), <br>array([[ 0.26000572],
						[-0.20826415],
						[ 0.06725556]]), <br>array([[-0.68644636],
						[ 0.32961181],
						[ 1.4217883 ]]), <br>array([[ 0.01649892],
						[-0.14198133],
						[ 1.57474915]]), <br>array([[ 0.05190661],
						[-0.69807807],
						[ 0.82150603]]))
					<p>tvecs :</p> 

					<p>(array([[ 3.04307359],
						[-1.22388435],
						[16.05929538]]), <br>array([[-3.02659696],
						[ 2.23760102],
						[12.44878562]]), <br>array([[ 3.50754501],
						[-1.62849374],
						[13.4914934 ]]), <br>array([[-4.48606727],
						[-0.22691993],
						[18.24453401]]), <br>array([[ 3.2408679 ],
						[-2.20850987],
						[16.48658753]]), <br>array([[ 2.05913497],
						[-1.41699544],
						[18.89359878]]), <br>array([[-1.85223215],
						[-2.10454171],
						[18.48411152]]), <br>array([[ 3.67876371],
						[-2.25851861],
						[14.73231102]]), <br>array([[-3.79184025],
						[-2.11379481],
						[16.44896473]]), <br>array([[ 1.92157795],
						[-2.84557839],
						[18.17655542]]), <br>array([[-2.18481237],
						[-2.24779745],
						[16.76734773]]), <br>array([[ 2.65321446],
						[-3.36055116],
						[18.25509596]]), <br>array([[ 2.78757729],
						[-2.13258889],
						[16.36612542]]), <br>array([[ 1.27114255],
						[-3.7317837 ],
						[18.5421511 ]]))</p>

				

				<h3>c) </h3>

				<p>Para esta etapa foram utilizadas imagens capturadas pela c√¢mera do celular com uma resolu√ß√£o bem maior do que a utilizada anteriormente.</p>


				<p>Camera matrix : </p>

					<p>[[690.57939917   0.         459.70860971]<br>
					[  0.         689.18030163 422.86297081]<br>
					[  0.           0.           1.        ]]</p>
					<p>dist :</p> 

					<p>[[-0.19201434  0.36787535 -0.01442795  0.00406974 -0.49560428]]</p>
					<p>rvecs :</p> 

					<p>(array([[-0.26376473],
						[ 0.24299112],
						[-1.21089966]]), <br>array([[-0.58171941],
						[-0.45530289],
						[-1.38013168]]), <br>array([[ 0.15662042],
						[-0.02658416],
						[ 1.58554542]]), <br>array([[-0.16304176],
						[-0.11128085],
						[ 0.54745919]]), <br>array([[ 0.37858058],
						[-0.29571776],
						[-1.01696836]]), <br>array([[-0.59293558],
						[ 0.0329549 ],
						[ 0.52883148]]), <br>array([[-1.04437208],
						[-0.38558207],
						[-0.80975221]]), <br>array([[-0.5780895 ],
						[-0.09542955],
						[-0.69297084]]), <br>array([[-0.5892605 ],
						[-0.21640485],
						[ 1.39271697]]), <br>array([[-0.28140131],
						[ 0.43286906],
						[-0.09606854]]), <br>array([[ 0.59169014],
						[-0.92852142],
						[ 0.08089715]]), <br>array([[-0.15918898],
						[ 0.0091384 ],
						[ 0.01369549]]), <br>array([[-0.23854841],
						[-0.18296492],
						[ 1.44317065]]))
					<p>tvecs : </p>

					<p>(array([[-3.26034657],
						[ 0.2235424 ],
						[11.34624057]]), <br>array([[-3.33036217],
						[ 0.48757511],
						[ 7.85922378]]), <br>array([[ 3.62255746],
						[-3.58924109],
						[ 8.6545276 ]]), <br>array([[-0.98219389],
						[-3.44440619],
						[11.14335641]]), <br>array([[-4.65145051],
						[-0.42435246],
						[11.58432783]]), <br>array([[-1.0077882 ],
						[-3.88586167],
						[14.83635978]]), <br>array([[-6.28329829],
						[ 0.30773385],
						[11.65832076]]), <br>array([[-3.62865469],
						[-2.43498695],
						[11.91371477]]), <br>array([[ 2.16386303],
						[-4.98976656],
						[14.613801  ]]), <br>array([[-2.79608728],
						[-2.63015994],
						[12.60429919]]), <br>array([[-1.7470227 ],
						[-1.19984893],
						[ 5.95174709]]), <br>array([[-3.19742441],
						[-3.6128068 ],
						[11.51175185]]), <br>array([[ 1.92771389],
						[-1.93490582],
						[13.56333082]]))</p>
			




			<h2>An√°lise e Discuss√£o</h2>

						<p>O opencv tem muitas fun√ß√µes que auxiliam na hora de determinarmos os parametros das c√¢meras e equipamento de captura, com isso n√£o √© necess√°rio que sejam criados c√≥digos para executar os c√°lculos ou mesmo identificar os padr√µes do tabuleiro de xadrez pois existem fun√ß√µes pr√≥prias j√° desenhadas para isso.
							<br>
						
						√â poss√≠vel utilizar outras imagens para a calibra√ß√£o do equipamento, por√©m devem seguir os requisitos de conterem padr√µes conhecidos de imagem e coordenadas definidas no mundo real.
						</p>
						<p>A defini√ß√£o da c√¢mera implica diretamente nos parametros encontrados, visto que mesmo utilizando o mesmo tabuleiro como amostra para calibragem, os parametros gerados nas partes 2 e 3 tiveram grande diferen√ßa nos valores.
						</p>
						<p>Para execu√ß√£o dos passos B e C da parte 2, alteramos um parametros importante no c√≥digo, CHECKERBOARD = (6,8), esse parametro defini o tipo de padr√£o e dimens√£o do nosso tabuleiro para que as coordenadas coincidam com os cantos das casas.</p>

			<h2>Conclus√µes</h2>

						<p>Antes de executarmos capturas de imagens com as c√¢meras, devemos realizar o processo de calibra√ß√£o do equipamento para evitar erros e distor√ß√µes nas imagens. Esse processo implica n√£o s√≥ em imagens mais n√≠tidas como tamb√©m mais confi√°veis para execu√ß√£o de diversos projetos que podem ser feitos utilizando o opencv e vis√£o computacional.<br>
						Uma imagem retirada sem a calibra√ß√£o adequada pode conter deforma√ß√µes que v√£o inviabilizar a utiliza√ß√£o dela para determinados fins.<br>
						Essa calibra√ß√£o pode ser feita em poucas linhas de c√≥digo com a ajuda da briblioteca opencv e suas fun√ß√µes.
						</p>
						
			
			<h2>Refer√™ncias</h2>

				<p>		  [1] Geometria da forma√ß√£o de imagens:
						https://learnopencv.com/geometry-of-image-formation/<br>
						 [2] Calibra√ß√£o de Camera com OpenCV:
						https://learnopencv.com/camera-calibration-using-opencv/ <br>
						 [3] Camera Calibration. Aten√ß√£o √† parte de Distor√ß√£o Radial da Lentes:
						https://docs.opencv.org/4.x/dc/dbb/tutorial_py_calibration.html <br>
						 [4] Camera Calibration Toolbox for Matlab:
						http://robots.stanford.edu/cs223b04/JeanYvesCalib/ <br>
						 [5] Pinhole camera model:
						https://en.wikipedia.org/wiki/Pinhole_camera_model <br>
				</p>


	</body>

</html>

